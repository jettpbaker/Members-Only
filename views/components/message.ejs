<script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/dayjs@1.10.7/plugin/relativeTime.min.js"></script>
<script>dayjs().format()</script>

<link rel="stylesheet" href="/css/message.css">
<section class="message">
    <div class="message-header">     
        <% if (isMember) { %>
            <h3><%= message.username %></h3>
            <p class="timestamp" data-timestamp="<%= message.posted %>"></p>
       <% } else { %>
        <h3 class="become-member-message">Become a member to see message author and timestamp</h3>
        <% } %>
    </div>
    <p><%= message.message %></p>
    <% if (isAdmin) { %>
        <form action="/delete-message/<%= message.id %>" method="POST">
            <button type="submit" class="delete-message">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M135.2 17.7C140.6 6.8 151.7 0 163.8 0L284.2 0c12.1 0 23.2 6.8 28.6 17.7L320 32l96 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 96C14.3 96 0 81.7 0 64S14.3 32 32 32l96 0 7.2-14.3zM32 128l384 0 0 320c0 35.3-28.7 64-64 64L96 512c-35.3 0-64-28.7-64-64l0-320zm96 64c-8.8 0-16 7.2-16 16l0 224c0 8.8 7.2 16 16 16s16-7.2 16-16l0-224c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16l0 224c0 8.8 7.2 16 16 16s16-7.2 16-16l0-224c0-8.8-7.2-16-16-16zm96 0c-8.8 0-16 7.2-16 16l0 224c0 8.8 7.2 16 16 16s16-7.2 16-16l0-224c0-8.8-7.2-16-16-16z"/></svg>
            </button>
    <% } %>
</section>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        dayjs.extend(window.dayjs_plugin_relativeTime)

        const timestampElements = document.querySelectorAll('.timestamp')
        timestampElements.forEach(element => {
            const timestamp = element.getAttribute('data-timestamp')
            let text = dayjs(timestamp).fromNow()
            
            // Check if the first character is a letter and capitalize if needed
            if (/^[a-zA-Z]/.test(text)) {
                text = text.charAt(0).toUpperCase() + text.slice(1)
            }
        
            element.textContent = text
        })
    })
</script>